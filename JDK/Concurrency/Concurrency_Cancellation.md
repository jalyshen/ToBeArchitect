# 任务取消

原文：http://ifeve.com/cancellation/



​        当某个线程中的活动执行失败或想改变运行意图，也许就有必要或想要在其它线程中取消这个线程的活动，而不管这个线程正在做什么。取消会给运行中的线程带来一些无法预料的失败情况。取消操作异步特性相关的设计技巧，让人想起了因系统崩溃和连接断开任何时候都有可能失败的分布式系统的那些技巧。并发程序还要确保多线程共享的对象的状态一致性。

​        在大多数多线程程序中，取消任务（Cancellation）是普遍存在的，常见于：

* 几乎所有与GUI中取消按钮相关的活动
* 多媒体演示（如动画循环）中的正常终止活动
* 线程中生成的结果不再需要。例如使用多个线程搜索数据库，只要某个线程返回了结果，其他的线程都可以取消
* 由于一组活动中的一个或多个遇到意外错误或异常导致整租活动无法继续



## 中断 (Interruption)

​        实现取消任务的最佳技术是使用线程的中断状态，这个状态由Thread.interrupt设置，可被Thread.isInterrupted检测到，通过Thread.interrupted清除，有时候抛出InterruptedException异常来响应。

​        线程中断起着请求取消活动的作用。但无法阻止有人将其用作它途，而用来作取消操作是预期的用途。基于中断的任务取消依赖于取消者和被取消者间的一个协议以确保跨多线程使用的对象在被取消线程终止的时候不被损坏。大部分（理想情况下是所有的）java.*包中的类都遵守这个协议。