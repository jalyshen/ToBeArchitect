# 椭圆曲线算法原理

原文：https://www.freebuf.com/articles/database/155912.html



​        椭圆曲线加密算法（ECC）是基于椭圆曲线数学的一种**公钥加密算法**。随着分解大整数方法的进步以及完善、计算机计算速度的提高以及网络的发展，RSA的使用率越来越高.但是为了安全。其密钥的长度一直保守诟病，于是ECC这种新算法逐步走上了现在加密算法的这个大舞台，其使用率和重要性都在逐年上升,那么今天我们就通过这篇文章来介绍一下椭圆曲线加密算法的初认识之数学基础。



## 椭圆曲线方程

​        椭圆曲线指的是一个齐次方程：
$$
y^2 + a1xy + a3y = x^3 +a2x^2 + a4x + a6
$$
数与形结合，所确定的平面曲线。其中，系数 $$ai(i=1,2,3...6)$$ 定义在某个有理数域、也可以定义在无理数域、复数域或者有限域$$GF(pr)$$。在ECC这个密码体制里，使用的是有限域$$GF(pr)$$。

​        曲线上的每个点都**必须**是非奇异的，所谓的“非奇异”或“光滑”的，在数学中是指：曲线上任意一点都存在切线。



### 等式一

$$
mP = \overbrace{P + P + P + ... + P} ^ {m} = Q
$$

​       这个等式，能看到已知一个**数**$$m$$和**点**$$P$$，求**点**$$Q$$很容易；反过来，已知点$$Q$$

和点$$P$$的情况下求$$m$$就非常的困难。这个问题称为离散对数问题中的椭圆曲线上的点群。

​        椭圆曲线密码体制，就是利用这个困难问题来设计的。

> 注：椭圆曲线的形状并不是椭圆，是因为椭圆曲线的描述方程，类似于一个椭圆的周长的方程而得名。



### 群、阿贝尔群

​        群，是一种代数结构，由一个集合以及一个二元运算组成。如果一个集合或者运算是群的话，就必须满足以下条件：

* 封闭性
* 结合性
* 单位元
* 逆元

以及满足数学中的交换律：
$$
a * (b * c) = a * c * b
$$

#### 定义椭圆曲线上的二元运算-加法

​        在椭圆中任意取两个点$$P$$和点$$Q$$，做直线交于椭圆曲线上的一点$$A$$，过点$$A$$

做$$y$$轴的平行线交于点$$B$$，于是，定义一个椭圆曲线上任意两点的“**加**”法运算：
$$
P+ Q = B
$$
这样，就可以保证“**加法**”得到的“**和**”也在椭圆上，也满足交换律和结合律。

​        根据上面提到“群”的定义，现在又了：

1. 一个叫**无穷远点的特殊点**，和椭圆**曲线上的所有点**构成一个集合”，
2. 定义了一个**加法运算**

这就构成一个特殊的群：阿贝尔（Abel）群。

​        显然，这个阿贝尔群**满足**上面提到的***等式一***，非常适合用于做加密。



### 椭圆曲线中的有限域

​        椭圆曲线是连续的，点和点貌似没有连续，如何加密呢？

​        给出**有限域 $$Fq$$** 的描述及其元素的表示，$$q$$ 是一个奇素数，或者是2的次幂方。当 $$q$$ 是奇素数 $$p$$ 时，要求 $$ p>2^{191} $$ ；当 $$q$$ 是2的方幂 $$2^m$$ 时，要求 $$ m > 192$$ 且为素数。

#### 有限素域$$Fp$$

* 当$$q$$是奇素数$$p$$时，素域$$Fp$$中的元素用整数$$0,1,2,...,p-1$$表示

1. 加法单位元是整数0
2. 乘法单位元是整数1
3. 域元素的加法是整数的模$$p$$加法，即若$$a,b \in Fp$$， 则$$a+b=(a+b) mod p$$
4. 域元素的乘法是整数的模$$p$$乘法，即若$$a,b \in Fp$$， 则$$a*b=(a*b) mod p$$

* 定义在$$Fp$$($$p$$是大于3的素数)上的椭圆曲线方程为：

$$
y^2 = x^3 +ax + b, a,b \in Fp
$$

​            且
$$
（4a^3 + 27b^2) mod p = 0
$$
​            椭圆曲线$$E(Fp)$$定义为：
$$
E(Fq) = (x,y)|x,y \in Fp
$$
​            且满足方程：
$$
（1）\cup O
$$
​            其中$$O$$是无穷远点。

​            椭圆曲线$$E(Fp)$$上的点的数目用*#E(Fq)*表示，称为**椭圆曲线$$E(Fp)$$的阶**。

​            如果椭圆曲线上一点$$P$$，存在最小的正整数$$n$$，使得数乘$$np=0\infty$$，则将$$n$$称为$$P$$的阶；若$$n$$不存在，则$$P$$是无限阶的。

​            事实上，在有限域上定义的椭圆曲线上所有的点的阶$$n$$都是存在的。



## 加密

​        描述一条$$Fp$$上的椭圆曲线，常用到的六个参量：$$T=(p,a,b,n,x,y)$$ 。其中，

* $$(p, a, b)$$用来确定一条椭圆曲线，$$p$$为素数域内点的个数，$$a$$和$$b$$是其内的两个大数
* $$x, y$$为$$G$$基点的坐标，也是两个大数
* $$n$$为点$$G$$基点的阶

以上六个量就可以描述一条椭圆曲线，有时候还会用到$$h$$（椭圆曲线上所有点的个数$$p$$与$$n$$相除的整数部分）。



### 加密过程

​        下面是整个加密、解密的过程：

1. A机器选定一条椭圆曲线$$Ep(a,b)$$并取椭圆曲线上一点，作为基点$$G$$

2. A机器选择一个私有密钥$$k$$，并生成公钥$$K=kG$$ (*用到曲线定义加法*)

3. A机器将$$Ep(a,b)$$和点$$K，G$$传给用户机器B

4. B机器接收到信息后，将待传输的明文编码到$$Ep(a,b)$$上一点$$M$$（编码方法很多，不做讨论），并产生一个随机整数$$r$$

5. B机器计算 $$C1 = M + rK; C2 = rG $$

6. B机器将点$$C1，C2$$传给机器A

7. A机器接收到信息后，计算$$C1-kC2$$，结果就是点$$M$$，因为：
   $$
   C1 - kC2 = M + rK - k(rG) = M + rK - r(kG) = M 
   $$

得到$$M$$后，再进行解密就可以得到明文。

​        这个加密通信过程中，如果有一个偷窥者H，他只能看到$$Ep(a,b)、K、G、C1、C2$$，而通过 $$K、G$$ 求 $$k$$ 或通过 $$C2、G$$ 求 $$r$$ 都是相当困难的。因此，H无法得到A、B间传送的明文信息。

