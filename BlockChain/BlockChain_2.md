# 区块链（二）

##              - 挖矿挖什么？

上篇，已经介绍了区块链的基本结构。从而得知，区块链之所以称之为“区块链”，是通过每个Block的Header中的 ***Parent-Hash*** 与上一块 Block 链上的。而这个Header 的Hash，又通过 Merkle-Root 与 Block 中的内容相关联的，从而保证了每个Block的防篡改。

这篇，来讲讲什么叫做“挖矿“。

## 一. 难度

上篇介绍区块的构成，其中有一个字段，叫做“**Difficulty**”。翻译为中文，就是“难易度”。怎么理解呢？

上篇就一句话介绍“Dificulty”，它是一个双层SHA-256的字符串。

先来看一个双层SHA-256的字符串，感性上认识一下SHA-256 串的模样：

​        ***9ffe3b827403dd06ea27c5c23532c3a92d2dc72a694ea3e3b28f979e1ff482f2***

这是十六进制的形式，一共 64 位，如果转换为二进制，就是256个比特（Bit）。

对于哈希值来说，可以把每一位上的数字看成是随机的。换句话说，如果想要改变这个SHA-256 串的值，可以通过不断更改SHA-256函数的输入值（变量）来达到目的。

那问题就来了。

如果要找到这样一个变量，其SHA-256后的字符串的首位为 ***0*** （例如，找 ***0ffe3b827403dd06ea27c5c23532c3a92d2dc72a694ea3e3b28f979e1ff482f2***），找到的概率是多少呢？

因为是16进制，所以找到**第一位是0**的的概率是$\frac{1}{16}$，那么如果**前两位都是0**的呢？概率就是 $(\frac{1}{16})^2$，以此类推…… 显然，前面的 **0** 越多， 找到的概率也就越低，难度也就越大……

这便是 BlockChain 中的 Difficulty 的真实含义了。

## 二、目标值

现在对“难度”有了感性认识。如果换一种说法，来看看是不是更好理解。

找到第一位是 ***0*** 的哈希值，其实就是要找到一个比 ***1000……*** （后面都是 *0*）要小的任何一个数。那么，就把 ***1000……*** 这个数叫做“**目标值**” - Target 。

矿工挖坑，就是要找到一个比 Target 小的哈希值。这个 Target 越小，难度越大。

## 三、 如何挖矿

终于知道矿工要干什么了。

那么如何挖呢？能不能随便输入一个值？当然不能，因为是要找某一个区块头的哈希值。再来回顾一下每个 Block 的组成结构：

![Block-structure](./images/BlockChain/BlockChain-Block-Structure.png)

通过这个结构，发现 BlockID、Parent-Hash、Merkle-Root、Timestamp都是固定值了，只有一个 ***nonce*** 这个值能被调整。

所以，所谓的挖坑，就是把前面的那些固定数据，结合 ***nonce*** 这个随机数，从$0$ 开始，不断递增，计算**双重** SHA-256 的哈希值，直到计算的哈希值小于当前系统约定好的 Target 值，表示当前矿工获得了这个区块的记账权，如果其他节点验证成功，这个区块就可以加入主链，于是乎，该矿工就获得了一笔奖励，挖矿成功过。

这就是挖矿的过程。

这个过程没有快捷算法，只能通过 不停的更新 nonce，暴力的进行双重哈希获取哈希值。



